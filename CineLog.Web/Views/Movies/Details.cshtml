@model CineLog.Web.ViewModels.MovieDetailViewModel

@{
    ViewData["Title"] = Model.Details.Title;
}

<div class="container mt-4 fade-in">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <a asp-action="Index" class="btn btn-outline-secondary rounded-pill px-4 hover-scale">
            <i class="bi bi-arrow-left me-2"></i> Listeye Dön
        </a>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show rounded-4 shadow-sm border-0 mb-4" role="alert">
            <i class="bi bi-check-circle-fill me-2"></i> <strong>Harika!</strong> @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-warning alert-dismissible fade show rounded-4 shadow-sm border-0 mb-4" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i> <strong>Dikkat!</strong> @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <div class="glass-panel p-4 p-lg-5 rounded-4 mb-5 shadow-lg position-relative overflow-hidden">

        <div style="position: absolute; top: -50px; right: -50px; width: 200px; height: 200px; background: radial-gradient(circle, rgba(255,193,7,0.2) 0%, rgba(0,0,0,0) 70%); border-radius: 50%; pointer-events: none;"></div>

        <div class="row g-4 g-lg-5 align-items-start">
            <div class="col-md-4 col-lg-3">
                <div class="movie-poster-container rounded-3 shadow-lg" style="aspect-ratio: 2/3;">
                    @if (Model.Details.PosterUrl != "N/A")
                    {
                        <img src="@Model.Details.PosterUrl" class="movie-poster w-100 h-100" alt="@Model.Details.Title">
                    }
                    else
                    {
                        <div class="d-flex flex-column align-items-center justify-content-center h-100 bg-dark text-secondary">
                            <i class="bi bi-image-fill display-4 mb-2"></i>
                            <span>Görsel Yok</span>
                        </div>
                    }
                </div>
            </div>

            <div class="col-md-8 col-lg-9 text-white">
                <div class="d-flex flex-column h-100">

                    <h1 class="display-5 fw-bold text-white mb-2 text-shadow-strong">@Model.Details.Title</h1>
                    <div class="mb-4">
                        <span class="badge bg-warning text-white rounded-pill fs-6 px-3 me-2">
                            <i class="bi bi-calendar-event me-1"></i> @Model.Details.Year
                        </span>
                        <span class="badge bg-secondary bg-opacity-50 border border-secondary border-opacity-25 rounded-pill fs-6 px-3">
                            @Model.Details.Genre
                        </span>
                    </div>

                    <div class="row mb-4 g-3">
                        <div class="col-auto">
                            <div class="bg-dark bg-opacity-50 p-3 rounded-3 border border-secondary border-opacity-25 d-flex align-items-center">
                                <i class="bi bi-star-fill text-warning fs-3 me-3"></i>
                                <div>
                                    <div class="fw-bold fs-4 lh-1">@Model.Details.ImdbRating</div>
                                    <small class="text-muted">IMDb Puanı</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-auto">
                            <div class="bg-dark bg-opacity-50 p-3 rounded-3 border border-secondary border-opacity-25 d-flex align-items-center">
                                <i class="bi bi-camera-reels text-info fs-3 me-3"></i>
                                <div>
                                    <div class="fw-bold fs-5 lh-1 text-white">@Model.Details.Director</div>
                                    <small class="text-muted">Yönetmen</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h5 class="text-warning mb-2">Özet</h5>
                    <p class="lead text-white-50 mb-4" style="font-size: 1.1rem;">
                        @Model.Details.Description
                    </p>

                    <div class="mt-auto pt-3 border-top border-secondary border-opacity-25">
                        <form asp-controller="Movies" asp-action="AddToList" method="post">
                            <input type="hidden" name="imdbId" value="@Model.Details.ImdbId" />
                            <button type="submit" class="btn btn-success btn-lg rounded-pill px-5 shadow-lg hover-scale fw-bold">
                                <i class="bi bi-plus-lg me-2"></i> İzleme Listeme Ekle
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @if (Model.Recommendations != null && Model.Recommendations.Any())
    {
        <div class="recommendations-section mb-5">
            <div class="d-flex align-items-center mb-4">
                <div class="bg-primary bg-opacity-10 text-primary p-2 rounded-circle me-3">
                    <i class="bi bi-lightning-charge-fill fs-4"></i>
                </div>
                <h3 class="text-white fw-bold mb-0">Bunu Sevenler Bunları da İzledi</h3>
            </div>

            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
                @foreach (var movie in Model.Recommendations)
                {
                    <div class="col">
                        <div class="card h-100 movie-card rounded-4">
                            <div class="movie-poster-container bg-dark position-relative">
                                <span class="position-absolute top-0 end-0 m-2 badge bg-warning text-white rounded-pill shadow-sm z-2 fw-bold">
                                    <i class="bi bi-star-fill me-1"></i> @movie.ImdbRating
                                </span>

                                @if (movie.PosterUrl != "N/A")
                                {
                                    <img src="@movie.PosterUrl" class="movie-poster" alt="@movie.Title">
                                }
                                else
                                {
                                    <div class="d-flex flex-column align-items-center justify-content-center h-100 text-secondary">
                                        <i class="bi bi-image-fill fs-1 mb-2"></i>
                                        <span>Görsel Yok</span>
                                    </div>
                                }
                            </div>

                            <div class="card-body d-flex flex-column">
                                <h6 class="card-title text-white fw-bold text-truncate mb-1" title="@movie.Title">
                                    @movie.Title
                                </h6>

                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <span class="text-muted small">
                                        <i class="bi bi-calendar-event me-1"></i> @movie.Year
                                    </span>
                                </div>

                                <a asp-action="Details" asp-route-id="@movie.ImdbId"
                                   class="btn btn-outline-light btn-sm mt-auto w-100 rounded-3 border-opacity-25 hover-warning stretched-link">
                                    <i class="bi bi-eye me-2"></i> İncele
                                </a>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    }
</div>